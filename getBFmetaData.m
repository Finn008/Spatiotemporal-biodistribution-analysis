function [OmeMetaDataRaw,OriginalMetaDataRaw]=getBFmetaData(Path2file)
keyboard; % still in use? 2015.10.09
evalc(['Wave1=bfopen(''',Path2file,''',1,1,1,1)']);
OriginalMetaDataRaw=Wave1{1,2};
OmeMetaDataRaw=Wave1{1,4};
clear Wave1;


[OriginalMetaData]=readHashtable(OriginalMetaDataRaw);

OmeMetaData=table;

Str='getArcAnnotationRef, getArcID, getArcLotNumber, getArcManufacturer, getArcModel, getArcPower, getArcSerialNumber, getArcType, getBinaryFileFileName, getBinaryFileMIMEType, getBinaryFileSize, getBinaryOnlyMetadataFile, getBinaryOnlyUUID, getBooleanAnnotationAnnotationCount, getBooleanAnnotationAnnotationRef, getBooleanAnnotationAnnotator, getBooleanAnnotationCount, getBooleanAnnotationDescription, getBooleanAnnotationID, getBooleanAnnotationNamespace, getBooleanAnnotationValue, getChannelAcquisitionMode, getChannelAnnotationRef, getChannelAnnotationRefCount, getChannelColor, getChannelContrastMethod, getChannelCount, getChannelEmissionWavelength, getChannelExcitationWavelength, getChannelFilterSetRef, getChannelFluor, getChannelID, getChannelIlluminationType, getChannelLightSourceSettingsAttenuation, getChannelLightSourceSettingsID, getChannelLightSourceSettingsWavelength, getChannelName, getChannelNDFilter, getChannelPinholeSize, getChannelPockelCellSetting, getChannelSamplesPerPixel, getCommentAnnotationAnnotationCount, getCommentAnnotationAnnotationRef, getCommentAnnotationAnnotator, getCommentAnnotationCount, getCommentAnnotationDescription, getCommentAnnotationID, getCommentAnnotationNamespace, getCommentAnnotationValue, getDatasetAnnotationRef, getDatasetAnnotationRefCount, getDatasetCount, getDatasetDescription, getDatasetExperimenterGroupRef, getDatasetExperimenterRef, getDatasetID, getDatasetImageRef, getDatasetImageRefCount, getDatasetName, getDatasetRefCount, getDetectorAmplificationGain, getDetectorAnnotationRef, getDetectorAnnotationRefCount, getDetectorCount, getDetectorGain, getDetectorID, getDetectorLotNumber, getDetectorManufacturer, getDetectorModel, getDetectorOffset, getDetectorSerialNumber, getDetectorSettingsBinning, getDetectorSettingsGain, getDetectorSettingsID, getDetectorSettingsIntegration, getDetectorSettingsOffset, getDetectorSettingsReadOutRate, getDetectorSettingsVoltage, getDetectorSettingsZoom, getDetectorType, getDetectorVoltage, getDetectorZoom, getDichroicAnnotationRef, getDichroicAnnotationRefCount, getDichroicCount, getDichroicID, getDichroicLotNumber, getDichroicManufacturer, getDichroicModel, getDichroicSerialNumber, getDoubleAnnotationAnnotationCount, getDoubleAnnotationAnnotationRef, getDoubleAnnotationAnnotator, getDoubleAnnotationCount, getDoubleAnnotationDescription, getDoubleAnnotationID, getDoubleAnnotationNamespace, getDoubleAnnotationValue, getEllipseAnnotationRef, getEllipseFillColor, getEllipseFillRule, getEllipseFontFamily, getEllipseFontSize, getEllipseFontStyle, getEllipseID, getEllipseLineCap, getEllipseLocked, getEllipseRadiusX, getEllipseRadiusY, getEllipseStrokeColor, getEllipseStrokeDashArray, getEllipseStrokeWidth, getEllipseText, getEllipseTheC, getEllipseTheT, getEllipseTheZ, getEllipseTransform, getEllipseVisible, getEllipseX, getEllipseY, getExperimentCount, getExperimentDescription, getExperimenterAnnotationRef, getExperimenterAnnotationRefCount, getExperimenterCount, getExperimenterEmail, getExperimenterFirstName, getExperimenterGroupAnnotationRef, getExperimenterGroupAnnotationRefCount, getExperimenterGroupCount, getExperimenterGroupDescription, getExperimenterGroupExperimenterRef, getExperimenterGroupExperimenterRefCount, getExperimenterGroupID, getExperimenterGroupLeader, getExperimenterGroupName, getExperimenterID, getExperimenterInstitution, getExperimenterLastName, getExperimenterMiddleName, getExperimenterUserName, getExperimentExperimenterRef, getExperimentID, getExperimentType, getFilamentAnnotationRef, getFilamentID, getFilamentLotNumber, getFilamentManufacturer, getFilamentModel, getFilamentPower, getFilamentSerialNumber, getFilamentType, getFileAnnotationAnnotationCount, getFileAnnotationAnnotationRef, getFileAnnotationAnnotator, getFileAnnotationCount, getFileAnnotationDescription, getFileAnnotationID, getFileAnnotationNamespace, getFilterAnnotationRef, getFilterAnnotationRefCount, getFilterCount, getFilterFilterWheel, getFilterID, getFilterLotNumber, getFilterManufacturer, getFilterModel, getFilterSerialNumber, getFilterSetCount, getFilterSetDichroicRef, getFilterSetEmissionFilterRef, getFilterSetEmissionFilterRefCount, getFilterSetExcitationFilterRef, getFilterSetExcitationFilterRefCount, getFilterSetID, getFilterSetLotNumber, getFilterSetManufacturer, getFilterSetModel, getFilterSetSerialNumber, getFilterType, getGenericExcitationSourceAnnotationRef, getGenericExcitationSourceID, getGenericExcitationSourceLotNumber, getGenericExcitationSourceManufacturer, getGenericExcitationSourceMap, getGenericExcitationSourceModel, getGenericExcitationSourcePower, getGenericExcitationSourceSerialNumber, getImageAcquisitionDate, getImageAnnotationRef, getImageAnnotationRefCount, getImageCount, getImageDescription, getImageExperimenterGroupRef, getImageExperimenterRef, getImageExperimentRef, getImageID, getImageInstrumentRef, getImageMicrobeamManipulationRef, getImageName, getImageROIRef, getImageROIRefCount, getImagingEnvironmentAirPressure, getImagingEnvironmentCO2Percent, getImagingEnvironmentHumidity, getImagingEnvironmentMap, getImagingEnvironmentTemperature, getInstrumentAnnotationRef, getInstrumentAnnotationRefCount, getInstrumentCount, getInstrumentID, getLabelAnnotationRef, getLabelFillColor, getLabelFillRule, getLabelFontFamily, getLabelFontSize, getLabelFontStyle, getLabelID, getLabelLineCap, getLabelLocked, getLabelStrokeColor, getLabelStrokeDashArray, getLabelStrokeWidth, getLabelText, getLabelTheC, getLabelTheT, getLabelTheZ, getLabelTransform, getLabelVisible, getLabelX, getLabelY, getLaserAnnotationRef, getLaserFrequencyMultiplication, getLaserID, getLaserLaserMedium, getLaserLotNumber, getLaserManufacturer, getLaserModel, getLaserPockelCell, getLaserPower, getLaserPulse, getLaserPump, getLaserRepetitionRate, getLaserSerialNumber, getLaserTuneable, getLaserType, getLaserWavelength, getLeaderCount, getLightEmittingDiodeAnnotationRef, getLightEmittingDiodeID, getLightEmittingDiodeLotNumber, getLightEmittingDiodeManufacturer, getLightEmittingDiodeModel, getLightEmittingDiodePower, getLightEmittingDiodeSerialNumber, getLightPathAnnotationRef, getLightPathAnnotationRefCount, getLightPathDichroicRef, getLightPathEmissionFilterRef, getLightPathEmissionFilterRefCount, getLightPathExcitationFilterRef, getLightPathExcitationFilterRefCount, getLightSourceAnnotationRefCount, getLightSourceCount, getLightSourceType, getLineAnnotationRef, getLineFillColor, getLineFillRule, getLineFontFamily, getLineFontSize, getLineFontStyle, getLineID, getLineLineCap, getLineLocked, getLineMarkerEnd, getLineMarkerStart, getLineStrokeColor, getLineStrokeDashArray, getLineStrokeWidth, getLineText, getLineTheC, getLineTheT, getLineTheZ, getLineTransform, getLineVisible, getLineX1, getLineX2, getLineY1, getLineY2, getListAnnotationAnnotationCount, getListAnnotationAnnotationRef, getListAnnotationAnnotator, getListAnnotationCount, getListAnnotationDescription, getListAnnotationID, getListAnnotationNamespace, getLongAnnotationAnnotationCount, getLongAnnotationAnnotationRef, getLongAnnotationAnnotator, getLongAnnotationCount, getLongAnnotationDescription, getLongAnnotationID, getLongAnnotationNamespace, getLongAnnotationValue, getMapAnnotationAnnotationCount, getMapAnnotationAnnotationRef, getMapAnnotationAnnotator, getMapAnnotationCount, getMapAnnotationDescription, getMapAnnotationID, getMapAnnotationNamespace, getMapAnnotationValue, getMaskAnnotationRef, getMaskFillColor, getMaskFillRule, getMaskFontFamily, getMaskFontSize, getMaskFontStyle, getMaskHeight, getMaskID, getMaskLineCap, getMaskLocked, getMaskStrokeColor, getMaskStrokeDashArray, getMaskStrokeWidth, getMaskText, getMaskTheC, getMaskTheT, getMaskTheZ, getMaskTransform, getMaskVisible, getMaskWidth, getMaskX, getMaskY, getMicrobeamManipulationCount, getMicrobeamManipulationDescription, getMicrobeamManipulationExperimenterRef, getMicrobeamManipulationID, getMicrobeamManipulationLightSourceSettingsAttenuation, getMicrobeamManipulationLightSourceSettingsCount, getMicrobeamManipulationLightSourceSettingsID, getMicrobeamManipulationLightSourceSettingsWavelength, getMicrobeamManipulationRefCount, getMicrobeamManipulationROIRef, getMicrobeamManipulationROIRefCount, getMicrobeamManipulationType, getMicroscopeLotNumber, getMicroscopeManufacturer, getMicroscopeModel, getMicroscopeSerialNumber, getMicroscopeType, getObjectiveAnnotationRef, getObjectiveAnnotationRefCount, getObjectiveCalibratedMagnification, getObjectiveCorrection, getObjectiveCount, getObjectiveID, getObjectiveImmersion, getObjectiveIris, getObjectiveLensNA, getObjectiveLotNumber, getObjectiveManufacturer, getObjectiveModel, getObjectiveNominalMagnification, getObjectiveSerialNumber, getObjectiveSettingsCorrectionCollar, getObjectiveSettingsID, getObjectiveSettingsMedium, getObjectiveSettingsRefractiveIndex, getObjectiveWorkingDistance, getPixelsBigEndian, getPixelsBinDataBigEndian, getPixelsBinDataCount, getPixelsDimensionOrder, getPixelsID, getPixelsInterleaved, getPixelsPhysicalSizeX, getPixelsPhysicalSizeY, getPixelsPhysicalSizeZ, getPixelsSignificantBits, getPixelsSizeC, getPixelsSizeT, getPixelsSizeX, getPixelsSizeY, getPixelsSizeZ, getPixelsTimeIncrement, getPixelsType, getPlaneAnnotationRef, getPlaneAnnotationRefCount, getPlaneCount, getPlaneDeltaT, getPlaneExposureTime, getPlaneHashSHA1, getPlanePositionX, getPlanePositionY, getPlanePositionZ, getPlaneTheC, getPlaneTheT, getPlaneTheZ, getPlateAcquisitionAnnotationRef, getPlateAcquisitionAnnotationRefCount, getPlateAcquisitionCount, getPlateAcquisitionDescription, getPlateAcquisitionEndTime, getPlateAcquisitionID, getPlateAcquisitionMaximumFieldCount, getPlateAcquisitionName, getPlateAcquisitionStartTime, getPlateAcquisitionWellSampleRef, getPlateAnnotationRef, getPlateAnnotationRefCount, getPlateColumnNamingConvention, getPlateColumns, getPlateCount, getPlateDescription, getPlateExternalIdentifier, getPlateFieldIndex, getPlateID, getPlateName, getPlateRefCount, getPlateRowNamingConvention, getPlateRows, getPlateStatus, getPlateWellOriginX, getPlateWellOriginY, getPointAnnotationRef, getPointFillColor, getPointFillRule, getPointFontFamily, getPointFontSize, getPointFontStyle, getPointID, getPointLineCap, getPointLocked, getPointStrokeColor, getPointStrokeDashArray, getPointStrokeWidth, getPointText, getPointTheC, getPointTheT, getPointTheZ, getPointTransform, getPointVisible, getPointX, getPointY, getPolygonAnnotationRef, getPolygonFillColor, getPolygonFillRule, getPolygonFontFamily, getPolygonFontSize, getPolygonFontStyle, getPolygonID, getPolygonLineCap, getPolygonLocked, getPolygonPoints, getPolygonStrokeColor, getPolygonStrokeDashArray, getPolygonStrokeWidth, getPolygonText, getPolygonTheC, getPolygonTheT, getPolygonTheZ, getPolygonTransform, getPolygonVisible, getPolylineAnnotationRef, getPolylineFillColor, getPolylineFillRule, getPolylineFontFamily, getPolylineFontSize, getPolylineFontStyle, getPolylineID, getPolylineLineCap, getPolylineLocked, getPolylineMarkerEnd, getPolylineMarkerStart, getPolylinePoints, getPolylineStrokeColor, getPolylineStrokeDashArray, getPolylineStrokeWidth, getPolylineText, getPolylineTheC, getPolylineTheT, getPolylineTheZ, getPolylineTransform, getPolylineVisible, getProjectAnnotationRef, getProjectAnnotationRefCount, getProjectCount, getProjectDatasetRef, getProjectDescription, getProjectExperimenterGroupRef, getProjectExperimenterRef, getProjectID, getProjectName, getReagentAnnotationRef, getReagentAnnotationRefCount, getReagentCount, getReagentDescription, getReagentID, getReagentName, getReagentReagentIdentifier, getRectangleAnnotationRef, getRectangleFillColor, getRectangleFillRule, getRectangleFontFamily, getRectangleFontSize, getRectangleFontStyle, getRectangleHeight, getRectangleID, getRectangleLineCap, getRectangleLocked, getRectangleStrokeColor, getRectangleStrokeDashArray, getRectangleStrokeWidth, getRectangleText, getRectangleTheC, getRectangleTheT, getRectangleTheZ, getRectangleTransform, getRectangleVisible, getRectangleWidth, getRectangleX, getRectangleY, getRightsRightsHeld, getRightsRightsHolder, getROIAnnotationRef, getROIAnnotationRefCount, getROICount, getROIDescription, getROIID, getROIName, getROINamespace, getScreenAnnotationRef, getScreenAnnotationRefCount, getScreenCount, getScreenDescription, getScreenID, getScreenName, getScreenPlateRef, getScreenProtocolDescription, getScreenProtocolIdentifier, getScreenReagentSetDescription, getScreenReagentSetIdentifier, getScreenType, getShapeAnnotationRefCount, getShapeCount, getShapeType, getStageLabelName, getStageLabelX, getStageLabelY, getStageLabelZ, getTagAnnotationAnnotationCount, getTagAnnotationAnnotationRef, getTagAnnotationAnnotator, getTagAnnotationCount, getTagAnnotationDescription, getTagAnnotationID, getTagAnnotationNamespace, getTagAnnotationValue, getTermAnnotationAnnotationCount, getTermAnnotationAnnotationRef, getTermAnnotationAnnotator, getTermAnnotationCount, getTermAnnotationDescription, getTermAnnotationID, getTermAnnotationNamespace, getTermAnnotationValue, getTiffDataCount, getTiffDataFirstC, getTiffDataFirstT, getTiffDataFirstZ, getTiffDataIFD, getTiffDataPlaneCount, getTimestampAnnotationAnnotationCount, getTimestampAnnotationAnnotationRef, getTimestampAnnotationAnnotator, getTimestampAnnotationCount, getTimestampAnnotationDescription, getTimestampAnnotationID, getTimestampAnnotationNamespace, getTimestampAnnotationValue, getTransmittanceRangeCutIn, getTransmittanceRangeCutInTolerance, getTransmittanceRangeCutOut, getTransmittanceRangeCutOutTolerance, getTransmittanceRangeTransmittance, getUUID, getUUIDFileName, getUUIDValue, getWellAnnotationRef, getWellAnnotationRefCount, getWellColor, getWellColumn, getWellCount, getWellExternalDescription, getWellExternalIdentifier, getWellID, getWellReagentRef, getWellRow, getWellSampleCount, getWellSampleID, getWellSampleImageRef, getWellSampleIndex, getWellSamplePositionX, getWellSamplePositionY, getWellSampleRefCount, getWellSampleTimepoint, getWellType, getXMLAnnotationAnnotationCount, getXMLAnnotationAnnotationRef, getXMLAnnotationAnnotator, getXMLAnnotationCount, getXMLAnnotationDescription, getXMLAnnotationID, getXMLAnnotationNamespace, getXMLAnnotationValue';
Str=regexprep(Str,' ','');
Str=regexprep(Str,',',''';''');
Str=['{''',Str,'''};'];
Str=eval(Str);

OmeMetaData=table;
OmeMetaData.Tag=Str;

for m=1:size(OmeMetaData,1)
    clear Wave1;
    Path=['Wave1=OmeMetaDataRaw.',OmeMetaData.Tag{m,1},'(0);'];
    try
        eval(Path);
    end
    if exist('Wave1')~=1 || isempty(Wave1)
        OmeMetaData.Remove(m,1)=1;
        continue;
    end
    if strfind1(OmeMetaData.Tag{m,1},'getPixelsPhysicalSize')
        Wave1=Wave1.value(ome.units.UNITS.MICROM).doubleValue; % in µm
    end
    if strfind1(OmeMetaData.Tag{m,1},'getPixelsSize')
        Wave1=Wave1.getValue();
    end
    if isnumeric(Wave1)==0 && ischar(Wave1)==0
        try
            Wave1=char(Wave1);
        end
    end
    OmeMetaData.Value(m,1)={Wave1};
end
OmeMetaData(OmeMetaData.Remove==1,:)=[];
OmeMetaData.Remove=[];
OmeMetaData.Properties.RowNames=OmeMetaData.Tag;

Fileinfo=table;
Fileinfo.GetSizeX=OmeMetaData.Value{'getPixelsSizeX'};
Fileinfo.GetSizeY=OmeMetaData.Value{'getPixelsSizeY'};
Fileinfo.GetSizeZ=OmeMetaData.Value{'getPixelsSizeZ'};
Fileinfo.Pix={[Fileinfo.GetSizeX;Fileinfo.GetSizeY;Fileinfo.GetSizeZ]};

Res(1)=OmeMetaData.Value{'getPixelsPhysicalSizeX'};
Res(2,1)=OmeMetaData.Value{'getPixelsPhysicalSizeY'};
Res(3,1)=OmeMetaData.Value{'getPixelsPhysicalSizeZ'};
Fileinfo.Res={Res};

Fileinfo.Um={Fileinfo.Res{1}.*Fileinfo.Pix{1}};

Type=FilenameTotal(end-3:end);
if strfind1({'.ids';'.lsm';'.czi'},Type,1)
    Fileinfo.UmStart{1}=-Fileinfo.Um{1}/2;
    Fileinfo.UmEnd{1}=+Fileinfo.Um{1}/2;
elseif strfind1({'ims'},Fileinfo.Type{1},1)
    keyboard;
else
    keyboard;
end

% Fileinfo.GetExtendMinX=Fileinfo.UmStart{1}(1,1);
% Fileinfo.GetExtendMinY=Fileinfo.UmStart{1}(2,1);
% Fileinfo.GetExtendMinZ=Fileinfo.UmStart{1}(3,1);
% Fileinfo.GetExtendMaxX=Fileinfo.UmEnd{1}(1,1);
% Fileinfo.GetExtendMaxY=Fileinfo.UmEnd{1}(2,1);
% Fileinfo.GetExtendMaxZ=Fileinfo.UmEnd{1}(3,1);
